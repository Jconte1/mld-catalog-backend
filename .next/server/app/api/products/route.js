"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4225:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{GET:()=>d,OPTIONS:()=>p,dynamic:()=>l});var a=r(9303),s=r(8716),n=r(670),i=r(6318),c=r(3717);function u(){return{"Access-Control-Allow-Origin":"https://www.mld.com","Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization",Vary:"Origin"}}let l="force-dynamic";function p(){return new Response(null,{status:204,headers:u()})}async function d(e){let t,r;let o=new URL(e.url),a=o.searchParams.get("type"),s=a?(0,c.Z)(a):void 0,n=parseInt(o.searchParams.get("page")||"1",10),l=o.searchParams.get("limit"),p=o.searchParams.get("filters"),d=o.searchParams.get("sort");console.log("\uD83D\uDCE5 FULL QUERY OBJECT:",Object.fromEntries(o.searchParams));try{if(p){let e=JSON.parse(p);console.log("\uD83D\uDD0D Parsed filters object:",e)}}catch(e){console.error("❌ Failed to parse filters JSON:",e)}let m="ALL"===l?null:parseInt(l||"15",10),h={};if(s&&(t={type:{equals:s.toUpperCase()}}),p)try{let e=JSON.parse(p);e.features?.length&&(h.features={hasEvery:e.features.map(e=>e.trim().toLowerCase())}),e.brand?.length&&(h.OR=e.brand.map(e=>({brand:{equals:e,mode:"insensitive"}}))),e.width?.length&&(h.width={in:e.width}),e.fueltype?.length&&(h.fuelType={hasSome:e.fueltype.map(e=>e.trim().toLowerCase())}),e.configuration?.length&&(h.configuration={hasSome:e.configuration.map(e=>e.trim().toLowerCase())}),e.producttype?.length&&(h.productType={hasSome:e.producttype.map(e=>e.trim().toLowerCase())})}catch(e){console.error("❌ Failed to parse filters:",p,e)}let g={...t,...h};console.log("\uD83D\uDCE5 sort param:",d),r="name_asc"===d?{model:"asc"}:"name_desc"===d?{model:"desc"}:"popular"===d?{popularity:"desc"}:{created_at:"desc"};try{console.log("\uD83D\uDFE3 Using orderBy:",r);let e=await i.Z.products.count({where:g}),t=await i.Z.products.findMany({where:g,skip:n>1&&m?(n-1)*m:0,take:m??void 0,orderBy:r,select:{id:!0,slug:!0,category:!0,type:!0,model:!0,brand:!0,major:!0,minor:!0,features:!0,configuration:!0,data:!0}});return Response.json({products:t,totalCount:e},{headers:u()})}catch(e){return console.error("❌ Prisma error in /api/products:",JSON.stringify(e,Object.getOwnPropertyNames(e),2)),Response.json({error:"Failed to fetch products"},{status:500,headers:u()})}}let m=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\james\\Documents\\MLDwebsite\\catalogue-backend\\app\\api\\products\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:f}=m,y="/api/products/route";function w(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},6318:(e,t,r)=>{r.d(t,{Z:()=>o});let o=new(require("@prisma/client")).PrismaClient},3717:(e,t,r)=>{r.d(t,{Z:()=>o});function o(e){return e?.toLowerCase().replace(/-/g," ").trim()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[176],()=>r(4225));module.exports=o})();