"use strict";(()=>{var e={};e.id=728,e.ids=[728],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},665:e=>{e.exports=require("dns")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},406:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>A,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{OPTIONS:()=>p,POST:()=>d});var o=t(9303),a=t(8716),n=t(670),i=t(6318),u=t(2221);function c(){return{"Access-Control-Allow-Origin":"https://www.mld.com","Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,POST,PUT,PATCH,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization",Vary:"Origin"}}function p(){return new Response(null,{status:204,headers:c()})}async function l(e,r){let t=u.createTransport({service:"gmail",auth:{user:process.env.AUTO_EMAIL,pass:process.env.AUTO_EMAIL_PASSWORD}});await t.sendMail({from:`"Closeout API Error" <${process.env.AUTO_EMAIL}>`,to:process.env.END_USER_EMAIL,cc:process.env.CC_EMAIL,subject:e,text:r})}async function d(e){try{let r=await e.json();if(!r?.Inserted||!Array.isArray(r.Inserted)||0===r.Inserted.length)return Response.json({error:"Invalid payload: Inserted array is required."},{status:400,headers:c()});let t=r.Inserted[0],s=t.InventoryID;if(!s)return Response.json({error:"Invalid payload: InventoryID is required."},{status:400,headers:c()});let o=s.trim(),a=o.split(" ");if(a.length<3)return Response.json({error:"Invalid acumaticaSku format. Expected at least 3 parts."},{status:400,headers:c()});let n=a[1],u=t.DefaultPrice,p="number"==typeof u?u:null,d=await i.Z.products.findFirst({where:{model:n}});if(!d){let e=`Product not found in catalog.

Model Number: "${n}"
Acumatica SKU: "${o}"`;return await l("âŒ Product Not Found in Catalog (Create Endpoint)",e),Response.json({error:"Product not found in catalog."},{status:404,headers:c()})}let A=await i.Z.closeout_inventory.upsert({where:{acumaticaSku:o},update:{price:p,lastSyncedAt:new Date},create:{productId:d.id,modelNumber:n,acumaticaSku:o,quantity:0,price:p,lastSyncedAt:new Date}});return Response.json({success:!0,closeoutRecord:A},{headers:c()})}catch(r){console.error("Error in /api/closeout/create:",r);let e=`An error occurred in /api/closeout/create:

${r.stack||r.message}`;try{await l("\uD83D\uDD25 Server Error in Create Endpoint",e)}catch(e){console.error("Failed to send error email:",e)}return Response.json({error:"Server error"},{status:500,headers:c()})}}let A=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/closeout/create/route",pathname:"/api/closeout/create",filename:"route",bundlePath:"app/api/closeout/create/route"},resolvedPagePath:"C:\\Users\\james\\Documents\\MLDwebsite\\catalogue-backend\\app\\api\\closeout\\create\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:x}=A,v="/api/closeout/create/route";function q(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},6318:(e,r,t)=>{t.d(r,{Z:()=>s});let s=new(require("@prisma/client")).PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[176,221],()=>t(406));module.exports=s})();